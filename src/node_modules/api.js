import fetch from 'node-fetch';

export const API_AUTH = 'http://localhost:5000/api';
export const API_YUGIOH = 'http://localhost:6000/api';

function fetchApi({ base, method, path, data, token }) {
    const opts = { method, headers: {} };
    if (data) {
        opts.headers['Content-Type'] = 'application/json';
        opts.body = JSON.stringify(data);
    } if (token) {
        opts.headers['Authorization'] = token;
    }
    return (new Promise((resolve, reject) => {
        fetch(`${base}${path}`, opts)
        .then(r => {
            r.text().then(text => {
                try {
                    const data = JSON.parse(text);
                    return (r.status !== 200 ? reject(data) : resolve(data));
                } catch (err) {
                    if (text === 'OK')
                        return (resolve(text));
                    else
                        return (reject(err));
                }
            });
        });
    }));
}

export function getApi(base, path, token) {
    return (fetchApi({ base, method: 'GET', path, token }));
}

export function postApi(base, path, data, token) {
    return (fetchApi({ base, method: 'POST', path, data, token }));
}

export function putApi(base, path, data, token) {
    return (fetchApi({ base, method: 'PUT', path, data, token }));
}

export function delApi(base, path, token) {
    return (fetchApi({ base, method: 'DELETE', path, token }));
}