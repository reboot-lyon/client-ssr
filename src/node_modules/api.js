import fetch from 'node-fetch';

const base = 'http://localhost:3000/api';

function fetchApi({ method, path, data, token }) {
    const opts = { method, headers: {} };
    if (data) {
        opts.headers['Content-Type'] = 'application/json';
        opts.body = JSON.stringify(data);
    } if (token) {
        opts.headers['Authorization'] = `Bearer ${token}`;
    }
    return (fetch(`${base}/${path}`, opts)
        .then(r => r.text())
        .then(json => {
            try {
                return (JSON.parse(json));
            } catch (err) {
                return (json);
            }
    }));
}

export function getApi(path, token) {
    return (fetchApi({ method: 'GET', path, token }));
}

export function postApi(path, data, token) {
    return (fetchApi({ method: 'POST', path, data, token }));
}

export function putApi(path, data, token) {
    return (fetchApi({ method: 'PUT', path, data, token }));
}

export function delApi(path, token) {
    return (fetchApi({ method: 'DELETE', path, token }));
}